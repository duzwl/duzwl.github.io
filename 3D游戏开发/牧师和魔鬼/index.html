<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>牧师和魔鬼 | duzw|博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="使用C#和unity3d实现大一导论课程涉及到的牧师与魔鬼小游戏。游戏规则：船可以搭载两个人，而且必须有一人掌船。无论何时，只要河一边的魔鬼数量多于牧师的数量，游戏就会以失败结束。">
<meta property="og:type" content="article">
<meta property="og:title" content="牧师和魔鬼">
<meta property="og:url" content="https://duzwl.github.io/3D游戏开发/牧师和魔鬼/index.html">
<meta property="og:site_name" content="duzw|博客">
<meta property="og:description" content="使用C#和unity3d实现大一导论课程涉及到的牧师与魔鬼小游戏。游戏规则：船可以搭载两个人，而且必须有一人掌船。无论何时，只要河一边的魔鬼数量多于牧师的数量，游戏就会以失败结束。">
<meta property="og:image" content="https://duzwl.github.io/1.png">
<meta property="og:image" content="https://duzwl.github.io/2.png">
<meta property="og:image" content="https://duzwl.github.io/3.png">
<meta property="og:image" content="https://duzwl.github.io/4.png">
<meta property="og:image" content="https://duzwl.github.io/5.png">
<meta property="og:image" content="https://duzwl.github.io/2.png">
<meta property="og:updated_time" content="2016-07-28T07:58:10.201Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="牧师和魔鬼">
<meta name="twitter:description" content="使用C#和unity3d实现大一导论课程涉及到的牧师与魔鬼小游戏。游戏规则：船可以搭载两个人，而且必须有一人掌船。无论何时，只要河一边的魔鬼数量多于牧师的数量，游戏就会以失败结束。">
<meta name="twitter:image" content="https://duzwl.github.io/1.png">
  
    <link rel="alternative" href="/atom.xml" title="duzw|博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">



	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/img/blog.png" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">笑看</a></h1>
		</hgroup>

		
		<p class="header-subtitle">Something that I have learned</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">日志</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/duzw1" title="github">github</a>
					        
								<a class="mail" target="_blank" href="https://mail.qq.com/609707451@qq.com" title="mail">mail</a>
					        
								<a class="facebook" target="_blank" href="https://www.facebook.com/profile.php?id=Zewei%20Du" title="facebook">facebook</a>
					        
								<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/C/" style="font-size: 18.33px;">C#</a> <a href="/tags/C-C/" style="font-size: 20px;">C/C++</a> <a href="/tags/CPU/" style="font-size: 13.33px;">CPU</a> <a href="/tags/MIPS/" style="font-size: 13.33px;">MIPS</a> <a href="/tags/MVC/" style="font-size: 16.67px;">MVC</a> <a href="/tags/blog/" style="font-size: 10px;">blog</a> <a href="/tags/cache/" style="font-size: 10px;">cache</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/procedure/" style="font-size: 10px;">procedure</a> <a href="/tags/semaphore/" style="font-size: 11.67px;">semaphore</a> <a href="/tags/thread/" style="font-size: 13.33px;">thread</a> <a href="/tags/unity3d/" style="font-size: 18.33px;">unity3d</a> <a href="/tags/verilog/" style="font-size: 11.67px;">verilog</a> <a href="/tags/工厂模式/" style="font-size: 15px;">工厂模式</a> <a href="/tags/序列化/" style="font-size: 10px;">序列化</a> <a href="/tags/排序/" style="font-size: 13.33px;">排序</a> <a href="/tags/汇编/" style="font-size: 10px;">汇编</a> <a href="/tags/观察者模式/" style="font-size: 10px;">观察者模式</a> <a href="/tags/递归/" style="font-size: 15px;">递归</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.cnblogs.com/KnowLXQ/p/5427555.html">小白入门</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://ibruce.info/2013/11/22/hexo-your-blog/">不如的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://theme-next.iissnan.com/third-party-services.html">NexT</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://ibruce.info/2015/04/04/busuanzi/">不蒜子</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">作为一个零基础的菜鸡程序猿，目标是迅速成长为攻城狮。大山中学14级本科生。</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">笑看</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="/img/blog.png" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">笑看</h1>
			</hgroup>
			
			<p class="header-subtitle">Something that I have learned</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">日志</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/duzw1" title="github">github</a>
			        
						<a class="mail" target="_blank" href="https://mail.qq.com/609707451@qq.com" title="mail">mail</a>
			        
						<a class="facebook" target="_blank" href="https://www.facebook.com/profile.php?id=Zewei%20Du" title="facebook">facebook</a>
			        
						<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap"><article id="post-牧师和魔鬼" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/3D游戏开发/牧师和魔鬼/" class="article-date">
  	<time datetime="2016-07-21T08:18:33.000Z" itemprop="datePublished">2016-07-21</time>
</a>
    </div>
  



  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      牧师和魔鬼
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C/">C#</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MVC/">MVC</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/unity3d/">unity3d</a></li></ul>
	</div>

        
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/3D游戏开发/">3D游戏开发</a>
	</div>


        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>使用C#和unity3d实现大一导论课程涉及到的牧师与魔鬼小游戏。游戏规则：船可以搭载两个人，而且必须有一人掌船。无论何时，只要河一边的魔鬼数量多于牧师的数量，游戏就会以失败结束。<br><a id="more"></a></p>
<h2 id="基本架构"><a href="#基本架构" class="headerlink" title="基本架构"></a><strong>基本架构</strong></h2><ul>
<li><p>UserInterface：用来创建GUI对象接受玩家动作，处理GUI事件，使用 IUserActions 接口控制游戏。属于MVC中的view，触发的时候调用controller，而controller调用model，完成游戏的运行工程。</p>
</li>
<li><p>SceneController：单实例对象，用来处理对象间通信和实现 IUserActions 接口。很明显，属于MVC中的controller。</p>
</li>
<li><p>BaseCode用来保存游戏名称和游戏简介，它注册在 SceneController 中。</p>
</li>
<li><p>GenGameObject：用来创建游戏对象和处理对象运动，它也注册在 SceneController 中。IUserActions 接口通过与 GenGameObject 互动完成游戏逻辑。属于MVC中的model，实现基础的上船等动作。</p>
</li>
</ul>
<p><img src="1.png" alt=""><br><img src="2.png" alt=""></p>
<h2 id="BaseCode-脚本"><a href="#BaseCode-脚本" class="headerlink" title="BaseCode 脚本"></a><strong>BaseCode 脚本</strong></h2><p>建立 BaseCode 脚本，并挂载到主摄像机。在 BaseCode 脚本里面声明一个新的命名空间 Com.Mygame，并把单实例对象GameSceneController 定义其中。这样的话，其它脚本要使用 GameSceneController 只需要在脚本开头添加 “using Com.Mygame” 就可以使用对象了，同时命名空间也将我们自己的类和系统类分别开来。<br>部分代码如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">using</span> UnityEngine;</div><div class="line"><span class="keyword">using</span> System.Collections;</div><div class="line"><span class="keyword">using</span> Com.Mygame;</div><div class="line"></div><div class="line"><span class="keyword">namespace</span> Com.Mygame &#123;</div><div class="line">	</div><div class="line">	<span class="keyword">public</span> <span class="keyword">class</span> GameSceneController: System.Object &#123;</div><div class="line">		</div><div class="line">		<span class="keyword">private</span> <span class="keyword">static</span> GameSceneController <span class="number">_</span>instance;</div><div class="line">		<span class="keyword">private</span> BaseCode <span class="number">_b</span>ase_code;</div><div class="line">		</div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> GameSceneController <span class="title">GetInstance</span><span class="params">()</span> </span>&#123;</div><div class="line">			<span class="keyword">if</span> (null == <span class="number">_</span>instance) &#123;</div><div class="line">				<span class="number">_</span>instance = <span class="keyword">new</span> GameSceneController();</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">return</span> <span class="number">_</span>instance;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		<span class="function"><span class="keyword">public</span> BaseCode <span class="title">getBaseCode</span><span class="params">()</span> </span>&#123;</div><div class="line">			<span class="keyword">return</span> <span class="number">_b</span>ase_code;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		<span class="function">internal <span class="keyword">void</span> <span class="title">setBaseCode</span><span class="params">(BaseCode bc)</span> </span>&#123;</div><div class="line">			<span class="keyword">if</span> (null == <span class="number">_b</span>ase_code) &#123;</div><div class="line">				<span class="number">_b</span>ase_code = bc;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> BaseCode : MonoBehaviour &#123;</div><div class="line">	</div><div class="line">	<span class="keyword">public</span> <span class="built_in">string</span> gameName;</div><div class="line">	<span class="keyword">public</span> <span class="built_in">string</span> gameRule;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Start</span> <span class="params">()</span> </span>&#123;</div><div class="line">		GameSceneController my = GameSceneController.GetInstance();</div><div class="line">		my.setBaseCode(<span class="keyword">this</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>单例类，即是全局中只能存在唯一一个对象的类，通过函数GetInstance()可以获得这个类的实例对象。因为 GameSceneController 单例类直接声明在 Com.Mygame 命名空间里，因此是全局的，在其中注入的对象都可以看作是全局对象，比如 BaseCode 对象。</p>
<p>这样做的目的是实现代码的MVC架构，通过在单例类中注入对象可以实现对象间的通信，而无需使用 Find、SendMessage 这类破坏程序结构的通讯耦合语句。</p>
<h2 id="GenGameObject脚本"><a href="#GenGameObject脚本" class="headerlink" title="GenGameObject脚本"></a><strong>GenGameObject脚本</strong></h2><h3 id="基本设置"><a href="#基本设置" class="headerlink" title="基本设置"></a><strong>基本设置</strong></h3><p>部分代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> GenGameObject : MonoBehaviour &#123;</div><div class="line"></div><div class="line">	Stack&lt;GameObject&gt; priests_start = <span class="keyword">new</span> Stack&lt;GameObject&gt;();</div><div class="line">	Stack&lt;GameObject&gt; priests_end = <span class="keyword">new</span> Stack&lt;GameObject&gt;();</div><div class="line">	Stack&lt;GameObject&gt; devils_start = <span class="keyword">new</span> Stack&lt;GameObject&gt;();</div><div class="line">	Stack&lt;GameObject&gt; devils_end = <span class="keyword">new</span> Stack&lt;GameObject&gt;();</div><div class="line"></div><div class="line">	GameObject[] boat = <span class="keyword">new</span> GameObject[<span class="number">2</span>];</div><div class="line">	GameObject boat_obj;</div><div class="line">	<span class="keyword">public</span> <span class="keyword">float</span> speed = <span class="number">100f</span>;</div><div class="line"></div><div class="line">	GameSceneController my;</div><div class="line"></div><div class="line">	Vector3 shoreStartPos = <span class="keyword">new</span> Vector3(<span class="number">0</span>, <span class="number">0</span>, <span class="number">-12</span>);</div><div class="line">	Vector3 shoreEndPos = <span class="keyword">new</span> Vector3(<span class="number">0</span>, <span class="number">0</span>, <span class="number">12</span>);</div><div class="line">	Vector3 boatStartPos = <span class="keyword">new</span> Vector3(<span class="number">0</span>, <span class="number">0</span>, <span class="number">-4</span>);</div><div class="line">	Vector3 boatEndPos = <span class="keyword">new</span> Vector3(<span class="number">0</span>, <span class="number">0</span>, <span class="number">4</span>);</div><div class="line"></div><div class="line">	<span class="keyword">float</span> gap = <span class="number">1.5f</span>;</div><div class="line">	Vector3 priestStartPos = <span class="keyword">new</span> Vector3(<span class="number">0</span>, <span class="number">2.7f</span>, <span class="number">-11</span>f);</div><div class="line">	Vector3 priestEndPos = <span class="keyword">new</span> Vector3(<span class="number">0</span>, <span class="number">2.7f</span>, <span class="number">8f</span>);</div><div class="line">	Vector3 devilStartPos = <span class="keyword">new</span> Vector3(<span class="number">0</span>, <span class="number">2.7f</span>, <span class="number">-16</span>f);</div><div class="line">	Vector3 devilEndPos = <span class="keyword">new</span> Vector3(<span class="number">0</span>, <span class="number">2.7f</span>, <span class="number">13f</span>);</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这部分声明了 GenGameObject  各变量，其中我打算用 Stack 集合类型存储牧师和魔鬼对象，start表示开始岸，end表示目标岸。</p>
<p>船需要三个变量，boat是一个对象数组，用来存储船所承载的物体，boat_obj为船的实体。Speed为公有变量（方便更改），代表船行驶的速度。</p>
<p>My是一个 GameSceneController 对象，之所以需要 GameSceneController，是因为游戏逻辑需要“状态”，这些“状态”为枚举类型，并且保存在 GameSceneController 中。</p>
<p>剩下的一系列 Vector3 类型，均表示物理位置，它们会在牧师、魔鬼、河岸、船预设实例化的时候被使用，或者在游戏物体需要移动时使用。</p>
<h3 id="完善动作"><a href="#完善动作" class="headerlink" title="完善动作"></a><strong>完善动作</strong></h3><p>由于牧师和魔鬼的位置时刻要根据堆栈的数据变化，因此先定义一个 setCharacterPositions 函数。该函数接受一个stack参数，和一个Vector3坐标。它的作用就是把stack里的object从Vector3坐标开始依次排开：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">setCharacterPositions</span><span class="params">(Stack&lt;GameObject&gt; <span class="built_in">stack</span>, Vector3 pos)</span> </span>&#123;</div><div class="line">	GameObject[] <span class="built_in">array</span> = <span class="built_in">stack</span>.ToArray();</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">stack</span>.Count; ++i) &#123;</div><div class="line">		<span class="built_in">array</span>[i].transform.position = <span class="keyword">new</span> Vector3(pos.x, pos.y, pos.z + gap*i);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后在 Update 方法里便可以使用： </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">Update</span><span class="params">()</span> </span>&#123;</div><div class="line">	setCharacterPositions(priests_start, priestStartPos);</div><div class="line">	setCharacterPositions(priests_end, priestEndPos);</div><div class="line">	setCharacterPositions(devils_start, devilStartPos);</div><div class="line">	setCharacterPositions(devils_end, devilEndPos);</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="上船"><a href="#上船" class="headerlink" title="上船"></a><strong>上船</strong></h4><p>把一个游戏对象设为船的子对象。定义 getOnTheBoat 函数，接受一个游戏对象为参数，只要船上有空位，就把游戏对象设置为船的子对象，这样游戏对象便能跟着船移动：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">getOnTheBoat</span><span class="params">(GameObject obj)</span> </span>&#123;</div><div class="line">	<span class="keyword">if</span> (boatCapacity() != <span class="number">0</span>) &#123;</div><div class="line">		obj.transform.parent = boat_obj.transform;</div><div class="line">		<span class="keyword">if</span> (boat[<span class="number">0</span>] == null) &#123;</div><div class="line">			boat[<span class="number">0</span>] = obj;</div><div class="line">			obj.transform.localPosition = <span class="keyword">new</span> Vector3(<span class="number">0</span>, <span class="number">1.2f</span>, <span class="number">-0.3</span>f);</div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">			boat[<span class="number">1</span>] = obj;</div><div class="line">			obj.transform.localPosition = <span class="keyword">new</span> Vector3(<span class="number">0</span>, <span class="number">1.2f</span>, <span class="number">0.3f</span>);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="开船"><a href="#开船" class="headerlink" title="开船"></a><strong>开船</strong></h4><p>根据游戏“状态”，把船从一方移动到另一方。这里，我们讨论到了游戏状态，我们需要游戏状态了解船当前的位置。游戏状态作为枚举类型声明在 BaseCode 脚本中：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">enum</span> State &#123; BSTART, BSEMOVING, BESMOVING, BEND, WIN, LOSE &#125;;</div><div class="line"><span class="comment">// 停在开始岸（左边） 左移动到右  右到左  在右岸</span></div></pre></td></tr></table></figure>
<p>有了游戏状态，只需要定义一个 moveBoat 函数，修改游戏状态为MOVING即可，剩下的动作均在Update函数中完成：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">moveBoat</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">if</span> (boatCapacity() != <span class="number">2</span>) &#123;</div><div class="line">		<span class="keyword">if</span> (my.state == State.BSTART) &#123;</div><div class="line">			my.state = State.BSEMOVING;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (my.state == State.BEND) &#123;</div><div class="line">			my.state = State.BESMOVING;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="下船"><a href="#下船" class="headerlink" title="下船"></a><strong>下船</strong></h4><p>取消船和游戏对象的父子关系，并且根据游戏“状态”将游戏对象压入stack。定义 getOffTheBoat 函数，接受一个整型变量为参数，该变量可以为0或1：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getOffTheBoat</span><span class="params">(<span class="keyword">int</span> side)</span> </span>&#123;</div><div class="line">	<span class="keyword">if</span> (boat[side] != null) &#123;</div><div class="line">		boat[side].transform.parent = null;</div><div class="line">		<span class="keyword">if</span> (my.state == State.BEND) &#123;</div><div class="line">			<span class="keyword">if</span> (boat[side].tag == <span class="string">"Priest"</span>) &#123;</div><div class="line">				priests_end.Push(boat[side]);</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (boat[side].tag == <span class="string">"Devil"</span>) &#123;</div><div class="line">				devils_end.Push(boat[side]);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (my.state == State.BSTART) &#123;</div><div class="line">			<span class="keyword">if</span> (boat[side].tag == <span class="string">"Priest"</span>) &#123;</div><div class="line">				priests_start.Push(boat[side]);</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (boat[side].tag == <span class="string">"Devil"</span>) &#123;</div><div class="line">				devils_start.Push(boat[side]);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		boat[side] = null;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>注意，为了区分出牧师和魔鬼，我给牧师和魔鬼预设分别添加了Tag。Tag需要在控制面板添加。<br><img src="3.png" alt=""><br><img src="4.png" alt=""></p>
<p>修改 Update 函数，加入船的移动，游戏结束条件的判断：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">Update</span><span class="params">()</span> </span>&#123;</div><div class="line">	setCharacterPositions(priests_start, priestStartPos);</div><div class="line">	setCharacterPositions(priests_end, priestEndPos);</div><div class="line">	setCharacterPositions(devils_start, devilStartPos);</div><div class="line">	setCharacterPositions(devils_end, devilEndPos);</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (my.state == State.BSEMOVING) &#123;</div><div class="line">		boat_obj.transform.position = Vector3.MoveTowards(boat_obj.transform.position, boatEndPos, speed*Time.deltaTime);</div><div class="line">		<span class="keyword">if</span> (boat_obj.transform.position == boatEndPos) &#123;</div><div class="line">			my.state = State.BEND;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (my.state == State.BESMOVING) &#123;</div><div class="line">		boat_obj.transform.position = Vector3.MoveTowards(boat_obj.transform.position, boatStartPos, speed*Time.deltaTime);</div><div class="line">		<span class="keyword">if</span> (boat_obj.transform.position == boatStartPos) &#123;</div><div class="line">			my.state = State.BSTART;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">else</span> check();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>为了与玩家规则表对应，还需要定义4个函数：<br>priestStartOnBoat、priestEndOnBoat、devilStartOnBoat、devilEndOnBoat<br>它们的作用是调用相应的 getOnTheBoat 函数，把玩家指定的对象放到船上：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">priestStartOnBoat</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">if</span> (priests_start.Count != <span class="number">0</span> &amp;&amp; boatCapacity() != <span class="number">0</span> &amp;&amp; my.state == State.BSTART)</div><div class="line">		getOnTheBoat(priests_start.Pop());</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">priestEndOnBoat</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">if</span> (priests_end.Count != <span class="number">0</span> &amp;&amp; boatCapacity() != <span class="number">0</span> &amp;&amp; my.state == State.BEND)</div><div class="line">		getOnTheBoat(priests_end.Pop());</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">devilStartOnBoat</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">if</span> (devils_start.Count != <span class="number">0</span> &amp;&amp; boatCapacity() != <span class="number">0</span> &amp;&amp; my.state == State.BSTART)</div><div class="line">		getOnTheBoat(devils_start.Pop());</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">devilEndOnBoat</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">if</span> (devils_end.Count != <span class="number">0</span> &amp;&amp; boatCapacity() != <span class="number">0</span> &amp;&amp; my.state == State.BEND)</div><div class="line">		getOnTheBoat(devils_end.Pop());</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="添加接口"><a href="#添加接口" class="headerlink" title="添加接口"></a><strong>添加接口</strong></h4><p>回到 BaseCode 脚本，在命名空间 Com.Mygame 里添加 IUserActions 接口：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> interface IUserActions &#123;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">priestSOnB</span><span class="params">()</span></span>;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">priestEOnB</span><span class="params">()</span></span>;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">devilSOnB</span><span class="params">()</span></span>;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">devilEOnB</span><span class="params">()</span></span>;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">moveBoat</span><span class="params">()</span></span>;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">offBoatL</span><span class="params">()</span></span>;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">offBoatR</span><span class="params">()</span></span>;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">restart</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在 GameSceneController 中添加接口的实现方法,即调用相关的函数。</p>
<h2 id="UserInterface脚本"><a href="#UserInterface脚本" class="headerlink" title="UserInterface脚本"></a><strong>UserInterface脚本</strong></h2><p>这里就不多讲了，主要是编写OnGUI函数，在合适的位置添加按钮，并且调用按钮所对应的接口函数：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (GUI.Button(<span class="keyword">new</span> Rect(castw(<span class="number">2f</span>), casth(<span class="number">6f</span>), width, height), <span class="string">"Go"</span>)) &#123;</div><div class="line">	action.moveBoat();</div><div class="line">&#125;</div><div class="line"><span class="keyword">if</span> (GUI.Button(<span class="keyword">new</span> Rect(castw(<span class="number">10.5f</span>), casth(<span class="number">4f</span>), width, height), <span class="string">"On"</span>)) &#123;</div><div class="line">	action.devilSOnB();</div><div class="line">&#125;</div><div class="line"><span class="keyword">if</span> (GUI.Button(<span class="keyword">new</span> Rect(castw(<span class="number">4.3f</span>), casth(<span class="number">4f</span>), width, height), <span class="string">"On"</span>)) &#123;</div><div class="line">	action.priestSOnB();</div><div class="line">&#125;</div><div class="line"><span class="keyword">if</span> (GUI.Button(<span class="keyword">new</span> Rect(castw(<span class="number">1.1f</span>), casth(<span class="number">4f</span>), width, height), <span class="string">"On"</span>)) &#123;</div><div class="line">	action.devilEOnB();</div><div class="line">&#125;</div><div class="line"><span class="keyword">if</span> (GUI.Button(<span class="keyword">new</span> Rect(castw(<span class="number">1.3f</span>), casth(<span class="number">4f</span>), width, height), <span class="string">"On"</span>)) &#123;</div><div class="line">	action.priestEOnB();</div><div class="line">&#125;</div><div class="line"><span class="keyword">if</span> (GUI.Button(<span class="keyword">new</span> Rect(castw(<span class="number">2.5f</span>), casth(<span class="number">1.3f</span>), width, height), <span class="string">"Off"</span>)) &#123;</div><div class="line">	action.offBoatL();</div><div class="line">&#125;</div><div class="line"><span class="keyword">if</span> (GUI.Button(<span class="keyword">new</span> Rect(castw(<span class="number">1.7f</span>), casth(<span class="number">1.3f</span>), width, height), <span class="string">"Off"</span>)) &#123;</div><div class="line">	action.offBoatR();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>最终游戏界面：<br><img src="5.png" alt=""></p>
<h2 id="unity界面"><a href="#unity界面" class="headerlink" title="unity界面"></a><strong>unity界面</strong></h2><ul>
<li>新建脚本GenGameObjects，挂载到主摄相机。新建脚本IUserInterface，挂载到一个Empty对象。</li>
<li>先在游戏面板创建游戏对象并调整其大小，在 Assets 文件夹下新建 Resources 文件夹，在 Resources 文件夹下新建 Prefabs 文件夹，然后将创建的对象拖入 Prefabs 中成为预设物体。这里牧师为球体、魔鬼为正方体、河岸为长方体、船也为长方体：<img src="2.png" alt=""></li>
<li>设置主摄像机的投影模式为正交投影，调整大小，这样看到的所有物体都是平面的了。</li>
</ul>
<h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a><strong>完整代码</strong></h2><h3 id="BaseCode-cs"><a href="#BaseCode-cs" class="headerlink" title="BaseCode.cs"></a><strong>BaseCode.cs</strong></h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">using</span> UnityEngine;</div><div class="line"><span class="keyword">using</span> System.Collections;</div><div class="line"><span class="keyword">using</span> Com.Mygame;</div><div class="line"></div><div class="line"><span class="keyword">namespace</span> Com.Mygame</div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> State &#123; BSTART, BSEMOVING, BESMOVING, BEND, WIN, LOSE &#125;;</div><div class="line">    <span class="comment">// 停在开始岸（左边） 左移动到右  右到左  在右岸  </span></div><div class="line"></div><div class="line">    <span class="keyword">public</span> interface IUserActions</div><div class="line">    &#123;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">priestSOnB</span><span class="params">()</span></span>;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">priestEOnB</span><span class="params">()</span></span>;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">devilSOnB</span><span class="params">()</span></span>;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">devilEOnB</span><span class="params">()</span></span>;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">moveBoat</span><span class="params">()</span></span>;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">offBoatL</span><span class="params">()</span></span>;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">offBoatR</span><span class="params">()</span></span>;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">restart</span><span class="params">()</span></span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">class</span> GameSceneController : System.Object, IUserActions</div><div class="line">    &#123;</div><div class="line"></div><div class="line">        <span class="keyword">private</span> <span class="keyword">static</span> GameSceneController <span class="number">_</span>instance;</div><div class="line">        <span class="keyword">private</span> BaseCode <span class="number">_b</span>ase_code;</div><div class="line">        <span class="keyword">private</span> GenGameObject <span class="number">_</span>gen_game_obj;</div><div class="line">        <span class="keyword">public</span> State state = State.BSTART;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> GameSceneController <span class="title">GetInstance</span><span class="params">()</span></span></div><div class="line">        &#123;</div><div class="line">            <span class="keyword">if</span> (null == <span class="number">_</span>instance)</div><div class="line">            &#123;</div><div class="line">                <span class="number">_</span>instance = <span class="keyword">new</span> GameSceneController();</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> <span class="number">_</span>instance;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> BaseCode <span class="title">getBaseCode</span><span class="params">()</span></span></div><div class="line">        &#123;</div><div class="line">            <span class="keyword">return</span> <span class="number">_b</span>ase_code;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function">internal <span class="keyword">void</span> <span class="title">setBaseCode</span><span class="params">(BaseCode bc)</span></span></div><div class="line">        &#123;</div><div class="line">            <span class="keyword">if</span> (null == <span class="number">_b</span>ase_code)</div><div class="line">            &#123;</div><div class="line">                <span class="number">_b</span>ase_code = bc;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> GenGameObject <span class="title">getGenGameObject</span><span class="params">()</span></span></div><div class="line">        &#123;</div><div class="line">            <span class="keyword">return</span> <span class="number">_</span>gen_game_obj;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function">internal <span class="keyword">void</span> <span class="title">setGenGameObject</span><span class="params">(GenGameObject ggo)</span></span></div><div class="line">        &#123;</div><div class="line">            <span class="keyword">if</span> (null == <span class="number">_</span>gen_game_obj)</div><div class="line">            &#123;</div><div class="line">                <span class="number">_</span>gen_game_obj = ggo;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">priestSOnB</span><span class="params">()</span></span></div><div class="line">        &#123;</div><div class="line">            <span class="number">_</span>gen_game_obj.priestStartOnBoat();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">priestEOnB</span><span class="params">()</span></span></div><div class="line">        &#123;</div><div class="line">            <span class="number">_</span>gen_game_obj.priestEndOnBoat();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">devilSOnB</span><span class="params">()</span></span></div><div class="line">        &#123;</div><div class="line">            <span class="number">_</span>gen_game_obj.devilStartOnBoat();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">devilEOnB</span><span class="params">()</span></span></div><div class="line">        &#123;</div><div class="line">            <span class="number">_</span>gen_game_obj.devilEndOnBoat();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">moveBoat</span><span class="params">()</span></span></div><div class="line">        &#123;</div><div class="line">            <span class="number">_</span>gen_game_obj.moveBoat();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">offBoatL</span><span class="params">()</span></span></div><div class="line">        &#123;</div><div class="line">            <span class="number">_</span>gen_game_obj.getOffTheBoat(<span class="number">0</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">offBoatR</span><span class="params">()</span></span></div><div class="line">        &#123;</div><div class="line">            <span class="number">_</span>gen_game_obj.getOffTheBoat(<span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">restart</span><span class="params">()</span></span></div><div class="line">        &#123;</div><div class="line">            Application.LoadLevel(Application.loadedLevelName);</div><div class="line">            state = State.BSTART;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> BaseCode : MonoBehaviour</div><div class="line">&#123;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="built_in">string</span> gameName;</div><div class="line">    <span class="keyword">public</span> <span class="built_in">string</span> gameRule;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        GameSceneController my = GameSceneController.GetInstance();</div><div class="line">        my.setBaseCode(<span class="keyword">this</span>);</div><div class="line">        gameName = <span class="string">"Priests and Devils"</span>;</div><div class="line">        gameRule = <span class="string">"Priests and Devils is a puzzle game in which you will help the Priests and Devils to cross the river within the time limit. There are 3 priests and 3 devils at one side of the river. They all want to get to the other side of this river, but there is only one boat and this boat can only carry two persons each time. And there must be one person steering the boat from one side to the other side. In the flash game, you can click on them to move them and click the go button to move the boat to the other direction. If the priests are out numbered by the devils on either side of the river, they get killed and the game is over. You can try it in many ways. Keep all priests alive! Good luck!             Sphere -- Priest	Cube -- Devil"</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="GenGameObject-cs"><a href="#GenGameObject-cs" class="headerlink" title="GenGameObject.cs"></a><strong>GenGameObject.cs</strong></h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">using</span> UnityEngine;</div><div class="line"><span class="keyword">using</span> System.Collections;</div><div class="line"><span class="keyword">using</span> System.Collections.Generic;</div><div class="line"><span class="keyword">using</span> Com.Mygame;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> GenGameObject : MonoBehaviour</div><div class="line">&#123;</div><div class="line"></div><div class="line">    Stack&lt;GameObject&gt; priests_start = <span class="keyword">new</span> Stack&lt;GameObject&gt;();</div><div class="line">    Stack&lt;GameObject&gt; priests_end = <span class="keyword">new</span> Stack&lt;GameObject&gt;();</div><div class="line">    Stack&lt;GameObject&gt; devils_start = <span class="keyword">new</span> Stack&lt;GameObject&gt;();</div><div class="line">    Stack&lt;GameObject&gt; devils_end = <span class="keyword">new</span> Stack&lt;GameObject&gt;();</div><div class="line"></div><div class="line">    GameObject[] boat = <span class="keyword">new</span> GameObject[<span class="number">2</span>];  <span class="comment">// 船上物体</span></div><div class="line">    GameObject boat_obj;  <span class="comment">// 船实体</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">float</span> speed = <span class="number">100f</span>;</div><div class="line"></div><div class="line">    GameSceneController my;</div><div class="line"></div><div class="line">    Vector3 shoreStartPos = <span class="keyword">new</span> Vector3(<span class="number">0</span>, <span class="number">0</span>, <span class="number">-12</span>);</div><div class="line">    Vector3 shoreEndPos = <span class="keyword">new</span> Vector3(<span class="number">0</span>, <span class="number">0</span>, <span class="number">12</span>);</div><div class="line">    Vector3 boatStartPos = <span class="keyword">new</span> Vector3(<span class="number">0</span>, <span class="number">0</span>, <span class="number">-4</span>);</div><div class="line">    Vector3 boatEndPos = <span class="keyword">new</span> Vector3(<span class="number">0</span>, <span class="number">0</span>, <span class="number">4</span>);</div><div class="line"></div><div class="line">    <span class="keyword">float</span> gap = <span class="number">1.5f</span>;  <span class="comment">// 控制速度</span></div><div class="line">    Vector3 priestStartPos = <span class="keyword">new</span> Vector3(<span class="number">0</span>, <span class="number">2.7f</span>, <span class="number">-11</span>f);</div><div class="line">    Vector3 priestEndPos = <span class="keyword">new</span> Vector3(<span class="number">0</span>, <span class="number">2.7f</span>, <span class="number">8f</span>);</div><div class="line">    Vector3 devilStartPos = <span class="keyword">new</span> Vector3(<span class="number">0</span>, <span class="number">2.7f</span>, <span class="number">-16</span>f);</div><div class="line">    Vector3 devilEndPos = <span class="keyword">new</span> Vector3(<span class="number">0</span>, <span class="number">2.7f</span>, <span class="number">13f</span>);</div><div class="line"></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        my = GameSceneController.GetInstance();</div><div class="line">        my.setGenGameObject(<span class="keyword">this</span>);</div><div class="line">        loadSrc();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">loadSrc</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="comment">// shore</span></div><div class="line">        Instantiate(Resources.Load(<span class="string">"Prefabs/Shore"</span>), shoreStartPos, Quaternion.identity);</div><div class="line">        Instantiate(Resources.Load(<span class="string">"Prefabs/Shore"</span>), shoreEndPos, Quaternion.identity);</div><div class="line">        <span class="comment">// boat</span></div><div class="line">        boat_obj = Instantiate(Resources.Load(<span class="string">"Prefabs/Boat"</span>), boatStartPos, Quaternion.identity) as GameObject;</div><div class="line">        <span class="comment">// priests &amp; devils</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; ++i)</div><div class="line">        &#123;</div><div class="line">            priests_start.Push(Instantiate(Resources.Load(<span class="string">"Prefabs/Priest"</span>)) as GameObject);</div><div class="line">            devils_start.Push(Instantiate(Resources.Load(<span class="string">"Prefabs/Devil"</span>)) as GameObject);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">boatCapacity</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">int</span> capacity = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; ++i)</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">if</span> (boat[i] == null) capacity++;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> capacity;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">getOnTheBoat</span><span class="params">(GameObject obj)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span> (boatCapacity() != <span class="number">0</span>)</div><div class="line">        &#123;</div><div class="line">            obj.transform.parent = boat_obj.transform;</div><div class="line">            <span class="keyword">if</span> (boat[<span class="number">0</span>] == null)</div><div class="line">            &#123;</div><div class="line">                boat[<span class="number">0</span>] = obj;</div><div class="line">                obj.transform.localPosition = <span class="keyword">new</span> Vector3(<span class="number">0</span>, <span class="number">1.2f</span>, <span class="number">-0.3</span>f);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">else</span> &#123;</div><div class="line">                boat[<span class="number">1</span>] = obj;</div><div class="line">                obj.transform.localPosition = <span class="keyword">new</span> Vector3(<span class="number">0</span>, <span class="number">1.2f</span>, <span class="number">0.3f</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">moveBoat</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span> (boatCapacity() != <span class="number">2</span>)</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">if</span> (my.state == State.BSTART)</div><div class="line">            &#123;</div><div class="line">                my.state = State.BSEMOVING;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (my.state == State.BEND)</div><div class="line">            &#123;</div><div class="line">                my.state = State.BESMOVING;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getOffTheBoat</span><span class="params">(<span class="keyword">int</span> side)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span> (boat[side] != null)</div><div class="line">        &#123;</div><div class="line">            boat[side].transform.parent = null;</div><div class="line">            <span class="keyword">if</span> (my.state == State.BEND)</div><div class="line">            &#123;</div><div class="line">                <span class="keyword">if</span> (boat[side].tag == <span class="string">"Priest"</span>)</div><div class="line">                &#123;</div><div class="line">                    priests_end.Push(boat[side]);</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (boat[side].tag == <span class="string">"Devil"</span>)</div><div class="line">                &#123;</div><div class="line">                    devils_end.Push(boat[side]);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (my.state == State.BSTART)</div><div class="line">            &#123;</div><div class="line">                <span class="keyword">if</span> (boat[side].tag == <span class="string">"Priest"</span>)</div><div class="line">                &#123;</div><div class="line">                    priests_start.Push(boat[side]);</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (boat[side].tag == <span class="string">"Devil"</span>)</div><div class="line">                &#123;</div><div class="line">                    devils_start.Push(boat[side]);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            boat[side] = null;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">priestStartOnBoat</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span> (priests_start.Count != <span class="number">0</span> &amp;&amp; boatCapacity() != <span class="number">0</span> &amp;&amp; my.state == State.BSTART)</div><div class="line">            getOnTheBoat(priests_start.Pop());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">priestEndOnBoat</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span> (priests_end.Count != <span class="number">0</span> &amp;&amp; boatCapacity() != <span class="number">0</span> &amp;&amp; my.state == State.BEND)</div><div class="line">            getOnTheBoat(priests_end.Pop());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">devilStartOnBoat</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span> (devils_start.Count != <span class="number">0</span> &amp;&amp; boatCapacity() != <span class="number">0</span> &amp;&amp; my.state == State.BSTART)</div><div class="line">            getOnTheBoat(devils_start.Pop());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">devilEndOnBoat</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span> (devils_end.Count != <span class="number">0</span> &amp;&amp; boatCapacity() != <span class="number">0</span> &amp;&amp; my.state == State.BEND)</div><div class="line">            getOnTheBoat(devils_end.Pop());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setCharacterPositions</span><span class="params">(Stack&lt;GameObject&gt; <span class="built_in">stack</span>, Vector3 pos)</span></span></div><div class="line">    &#123;</div><div class="line">        GameObject[] <span class="built_in">array</span> = <span class="built_in">stack</span>.ToArray();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">stack</span>.Count; ++i)</div><div class="line">        &#123;</div><div class="line">            <span class="built_in">array</span>[i].transform.position = <span class="keyword">new</span> Vector3(pos.x, pos.y, pos.z + gap * i);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">check</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">int</span> pOnb = <span class="number">0</span>, dOnb = <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> priests_s = <span class="number">0</span>, devils_s = <span class="number">0</span>, priests_e = <span class="number">0</span>, devils_e = <span class="number">0</span>;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (priests_end.Count == <span class="number">3</span> &amp;&amp; devils_end.Count == <span class="number">3</span>)</div><div class="line">        &#123;</div><div class="line">            my.state = State.WIN;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; ++i)</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">if</span> (boat[i] != null &amp;&amp; boat[i].tag == <span class="string">"Priest"</span>) pOnb++;</div><div class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (boat[i] != null &amp;&amp; boat[i].tag == <span class="string">"Devil"</span>) dOnb++;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (my.state == State.BSTART)</div><div class="line">        &#123;</div><div class="line">            priests_s = priests_start.Count + pOnb;</div><div class="line">            devils_s = devils_start.Count + dOnb;</div><div class="line">            priests_e = priests_end.Count;</div><div class="line">            devils_e = devils_end.Count;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (my.state == State.BEND)</div><div class="line">        &#123;</div><div class="line">            priests_s = priests_start.Count;</div><div class="line">            devils_s = devils_start.Count;</div><div class="line">            priests_e = priests_end.Count + pOnb;</div><div class="line">            devils_e = devils_end.Count + dOnb;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> ((priests_s != <span class="number">0</span> &amp;&amp; priests_s &lt; devils_s) || (priests_e != <span class="number">0</span> &amp;&amp; priests_e &lt; devils_e))</div><div class="line">        &#123;</div><div class="line">            my.state = State.LOSE;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        setCharacterPositions(priests_start, priestStartPos);</div><div class="line">        setCharacterPositions(priests_end, priestEndPos);</div><div class="line">        setCharacterPositions(devils_start, devilStartPos);</div><div class="line">        setCharacterPositions(devils_end, devilEndPos);</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (my.state == State.BSEMOVING)</div><div class="line">        &#123;</div><div class="line">            boat_obj.transform.position = Vector3.MoveTowards(boat_obj.transform.position, boatEndPos, speed * Time.deltaTime);</div><div class="line">            <span class="keyword">if</span> (boat_obj.transform.position == boatEndPos)</div><div class="line">            &#123;</div><div class="line">                my.state = State.BEND;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (my.state == State.BESMOVING)</div><div class="line">        &#123;</div><div class="line">            boat_obj.transform.position = Vector3.MoveTowards(boat_obj.transform.position, boatStartPos, speed * Time.deltaTime);</div><div class="line">            <span class="keyword">if</span> (boat_obj.transform.position == boatStartPos)</div><div class="line">            &#123;</div><div class="line">                my.state = State.BSTART;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span> check();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="UserInterface-cs"><a href="#UserInterface-cs" class="headerlink" title="UserInterface.cs"></a><strong>UserInterface.cs</strong></h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">using</span> UnityEngine;</div><div class="line"><span class="keyword">using</span> System.Collections;</div><div class="line"><span class="keyword">using</span> Com.Mygame;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> UserInterface : MonoBehaviour</div><div class="line">&#123;</div><div class="line"></div><div class="line">    GameSceneController my;</div><div class="line">    IUserActions action;</div><div class="line"></div><div class="line">    <span class="keyword">float</span> width, height;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">float</span> <span class="title">castw</span><span class="params">(<span class="keyword">float</span> scale)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> (Screen.width - width) / scale;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">float</span> <span class="title">casth</span><span class="params">(<span class="keyword">float</span> scale)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> (Screen.height - height) / scale;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        my = GameSceneController.GetInstance();</div><div class="line">        action = GameSceneController.GetInstance() as IUserActions;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnGUI</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        width = Screen.width / <span class="number">12</span>;</div><div class="line">        height = Screen.height / <span class="number">12</span>;</div><div class="line">        print(my.state);</div><div class="line">        <span class="keyword">if</span> (my.state == State.WIN)</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">if</span> (GUI.Button(<span class="keyword">new</span> Rect(castw(<span class="number">2f</span>), casth(<span class="number">6f</span>), width, height), <span class="string">"Win!"</span>))</div><div class="line">            &#123;</div><div class="line">                action.restart();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (my.state == State.LOSE)</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">if</span> (GUI.Button(<span class="keyword">new</span> Rect(castw(<span class="number">2f</span>), casth(<span class="number">6f</span>), width, height), <span class="string">"Lose!"</span>))</div><div class="line">            &#123;</div><div class="line">                action.restart();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">if</span> (GUI.RepeatButton(<span class="keyword">new</span> Rect(<span class="number">10</span>, <span class="number">10</span>, <span class="number">120</span>, <span class="number">20</span>), my.getBaseCode().gameName))</div><div class="line">            &#123;</div><div class="line">                GUI.TextArea(<span class="keyword">new</span> Rect(<span class="number">10</span>, <span class="number">40</span>, Screen.width - <span class="number">20</span>, Screen.height / <span class="number">2</span>), my.getBaseCode().gameRule);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (my.state == State.BSTART || my.state == State.BEND)</div><div class="line">            &#123;</div><div class="line">                <span class="keyword">if</span> (GUI.Button(<span class="keyword">new</span> Rect(castw(<span class="number">2f</span>), casth(<span class="number">6f</span>), width, height), <span class="string">"Go"</span>))</div><div class="line">                &#123;</div><div class="line">                    action.moveBoat();</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (GUI.Button(<span class="keyword">new</span> Rect(castw(<span class="number">10.5f</span>), casth(<span class="number">4f</span>), width, height), <span class="string">"On"</span>))</div><div class="line">                &#123;</div><div class="line">                    action.devilSOnB();</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (GUI.Button(<span class="keyword">new</span> Rect(castw(<span class="number">4.3f</span>), casth(<span class="number">4f</span>), width, height), <span class="string">"On"</span>))</div><div class="line">                &#123;</div><div class="line">                    action.priestSOnB();</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (GUI.Button(<span class="keyword">new</span> Rect(castw(<span class="number">1.1f</span>), casth(<span class="number">4f</span>), width, height), <span class="string">"On"</span>))</div><div class="line">                &#123;</div><div class="line">                    action.devilEOnB();</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (GUI.Button(<span class="keyword">new</span> Rect(castw(<span class="number">1.3f</span>), casth(<span class="number">4f</span>), width, height), <span class="string">"On"</span>))</div><div class="line">                &#123;</div><div class="line">                    action.priestEOnB();</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (GUI.Button(<span class="keyword">new</span> Rect(castw(<span class="number">2.5f</span>), casth(<span class="number">1.3f</span>), width, height), <span class="string">"Off"</span>))</div><div class="line">                &#123;</div><div class="line">                    action.offBoatL();</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (GUI.Button(<span class="keyword">new</span> Rect(castw(<span class="number">1.7f</span>), casth(<span class="number">1.3f</span>), width, height), <span class="string">"Off"</span>))</div><div class="line">                &#123;</div><div class="line">                    action.offBoatR();</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/3D游戏开发/牧师与魔鬼改进/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          牧师与魔鬼改进
        
      </div>
    </a>
  



  
    <a href="/3D游戏开发/井字棋/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">井字棋</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>
  <div class="busuanziye">
  本文总阅读量<span id="busuanzi_value_page_pv"></span>次
  </div>

    
  
  
  

</article>






<div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="牧师和魔鬼" data-title="牧师和魔鬼" data-url="https://duzwl.github.io/3D游戏开发/牧师和魔鬼/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"true"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>




</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 笑看
    	</div>

        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
        </script>
        <div id="busuanzi_container_site_uv" class="count">
        本站访客数<span id="busuanzi_value_site_uv"></span>人次
        </div>
    </div>

  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="/js/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>







<div id="totop" style="position:fixed;bottom:45px;right:65px;cursor: pointer;">
<a title="Back to Top"><img src="/img/scrollup.png"/></a>
</div>
<script src="/js/totop.js"></script>
  </div>
</body>
</html>